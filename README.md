# MaxTelegramBridgeBot

Мост между Telegram и [MAX](https://max.ru) мессенджером. Пересылает сообщения, медиа, файлы и редактирования между связанными чатами.

## Возможности

- Пересылка текстовых сообщений в обе стороны
- Пересылка медиа: фото, видео, документы, голосовые, аудио
- Поддержка ответов (reply) — сохраняется контекст
- Отслеживание редактирования сообщений
- Настраиваемый префикс `[TG]` / `[MAX]`
- SQLite или PostgreSQL для хранения связок и маппинга сообщений

## Быстрый старт

### 1. Создайте ботов

- **Telegram**: через [@BotFather](https://t.me/BotFather), отключите Privacy Mode (Bot Settings → Group Privacy → Turn off)
- **MAX**: через настройки платформы

### 2. Настройте окружение

```bash
cp .env.example .env
# Заполните TG_TOKEN и MAX_TOKEN
```

### 3. Запустите

```bash
go build -o bridge .
./bridge
```

### 4. Свяжите чаты

1. Добавьте бота в Telegram-группу и MAX-группу
2. В MAX сделайте бота **админом** группы
3. В одном из чатов отправьте `/bridge`
4. Бот выдаст ключ — отправьте `/bridge <ключ>` в другом чате

## Команды

| Команда | Описание |
|---------|----------|
| `/start`, `/help` | Инструкция |
| `/bridge` | Создать ключ для связки |
| `/bridge <ключ>` | Связать чат по ключу |
| `/bridge prefix on/off` | Включить/выключить префикс `[TG]`/`[MAX]` |
| `/unbridge` | Удалить связку |

## Деплой

```bash
# Первый раз — настройка systemd
./deploy.sh --setup

# Обновление
./deploy.sh
```

## Переменные окружения

| Переменная | Описание | По умолчанию |
|------------|----------|--------------|
| `TG_TOKEN` | Токен Telegram бота | — (обязательно) |
| `MAX_TOKEN` | Токен MAX бота | — (обязательно) |
| `DB_PATH` | Путь к SQLite базе | `bridge.db` |
| `DATABASE_URL` | DSN для PostgreSQL (если задана — SQLite игнорируется) | — |
